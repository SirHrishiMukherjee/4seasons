<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Heliocentric Seasons — 1080‑Day & Planetary Calendars (Earth + Mars)</title>
  <style>
    :root {
      --bg: #0b1020; --panel: #111831; --ink: #e6eefc; --muted: #9bb0d3; --accent: #8ad1ff;
      --spring: rgba(120, 220, 120, 0.35); --summer: rgba(255, 220, 100, 0.35);
      --autumn: rgba(255, 150, 60, 0.35); --winter: rgba(140, 180, 255, 0.35);
      --sec5: rgba(170,120,255,0.30); --sec6: rgba(255,120,190,0.30);
      --grid: rgba(255,255,255,0.06);
    }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, sans-serif; }
    header { padding: 14px 16px; display: flex; justify-content: space-between; align-items: center; gap: 12px; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0)); }
    h1 { font-size: 18px; letter-spacing: 0.5px; margin: 0; font-weight: 600; color: var(--ink); }
    .sub { color: var(--muted); font-size: 12px; }
    .wrap { display: grid; grid-template-columns: 380px 1fr; gap: 14px; height: calc(100% - 58px); padding: 12px; box-sizing: border-box; }
    .panel { background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 14px; box-shadow: 0 8px 30px rgba(0,0,0,0.25) inset, 0 2px 12px rgba(0,0,0,0.25); }
    .panel h2 { margin: 4px 0 8px; font-size: 14px; font-weight: 600; color: var(--ink); }
    .control { margin: 12px 0; }
    .control label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    select, input[type="range"] { width: 100%; }
    .row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    button { background: #1a2447; color: var(--ink); border: 1px solid rgba(255,255,255,0.12); padding: 8px 12px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: transform .08s ease, background .25s ease; }
    button:hover { transform: translateY(-1px); }
    button.active { background: #243063; border-color: var(--accent); }
    .legend { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
    .tag { display:flex; align-items:center; gap:8px; font-size:12px; color: var(--muted); }
    .dot { width: 12px; height: 12px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.5); }
    .spring { background: var(--spring); }
    .summer { background: var(--summer); }
    .autumn { background: var(--autumn); }
    .winter { background: var(--winter); }
    .sec5 { background: var(--sec5); }
    .sec6 { background: var(--sec6); }
    .marsDot { background: #ffad7a; }
    .canvasWrap { position: relative; }
    canvas { width: 100%; height: 100%; display: block; background: radial-gradient(1200px 600px at 30% 30%, rgba(90,130,255,0.15), rgba(0,0,0,0)); border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); }
    .readout { position: absolute; left: 12px; bottom: 12px; background: rgba(0,0,0,0.45); padding: 8px 10px; border-radius: 10px; font-size: 12px; color: var(--ink); backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.08); }
    .note { font-size: 11px; color: var(--muted); line-height: 1.4; }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Heliocentric Orbit — Planetary & 1080‑Day Calendars</h1>
      <div class="sub">Earth · Mars · Co‑orbital (EM belt) — seasons & month segmentation</div>
    </div>
    <div class="sub">Simulon · Orbital Calendar Canvas</div>
  </header>

  <div class="wrap">
    <aside class="panel">
      <h2>World & Calendar</h2>
      <div class="control">
        <label for="world">World (drives section counts & labels)</label>
        <select id="world">
          <option value="earth">Earth (365‑day orbital year)</option>
          <option value="mars">Mars (687‑day orbital year)</option>
          <option value="coorb">Co‑Orbital (between Earth & Mars) — nominal 540‑day year</option>
        </select>
      </div>
      <div class="control">
        <label for="basis">Year Basis</label>
        <select id="basis">
          <option value="orbital">Orbital year (true days)</option>
          <option value="1080">1080‑day calendar (36×30)</option>
          <option value="1290">Normalized Gregorian (12×90)</option>
        </select>
      </div>
      <div class="control">
        <label for="seasons">Seasons (4–6)</label>
        <input id="seasons" type="range" min="4" max="6" step="1" value="6" />
      </div>
      <div class="row">
        <label class="sub"><input type="checkbox" id="lockRecommended" checked /> Use recommended season count per world</label>
      </div>
      <div class="control">
        <label for="day">Day in Year (<span id="dayVal">0</span>/<span id="yearLen">0</span>)</label>
        <input id="day" type="range" min="0" max="365" step="1" value="0" />
      </div>
      <div class="row">
        <button id="play">▶ Play</button>
        <button id="pause">⏸ Pause</button>
        <button id="reset">↺ Reset</button>
      </div>
      <div class="control">
        <label>Overlays</label>
        <div class="row">
          <label class="sub"><input type="checkbox" id="showMonths" checked /> Show months</label>
          <label class="sub"><input type="checkbox" id="showBounds" checked /> Show equinox/solstice ticks</label>
          <label class="sub"><input type="checkbox" id="showMars" checked /> Show Mars orbit & planet</label>
        </div>
      </div>
      <div class="legend">
        <div class="tag"><span class="dot spring"></span> Section A</div>
        <div class="tag"><span class="dot summer"></span> Section B</div>
        <div class="tag"><span class="dot autumn"></span> Section C</div>
        <div class="tag"><span class="dot winter"></span> Section D</div>
        <div class="tag"><span class="dot sec5"></span> Section E (5th)</div>
        <div class="tag"><span class="dot sec6"></span> Section F (6th)</div>
        <div class="tag"><span class="dot marsDot"></span> Mars Orbit & Planet</div>
      </div>
      <div class="control">
        <h2>Notes</h2>
        <p class="note">Mars has four astronomical seasons (uneven lengths) due to axial tilt and higher orbital eccentricity. The co‑orbital belt uses a nominal 540‑day year with a recommended <strong>six</strong> seasons (6×90 under 1080‑basis → 180‑day sections on orbital basis). Toggle 4–6 as desired.</p>
        <p class="note">1080‑day calendar = 36×30; Normalized Gregorian = 12×90. In orbital basis, Earth=365, Mars=687, Co‑orbital=540.</p>
      </div>
    </aside>

    <main class="canvasWrap">
      <canvas id="orb" width="1200" height="800" aria-label="Heliocentric orbit with Earth & Mars and multi‑season calendar sections" role="img"></canvas>
      <div class="readout" id="readout">—</div>
    </main>
  </div>

  <script>
    // ===== Scene setup =====
    const canvas = document.getElementById('orb');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    const cx = W * 0.55, cy = H * 0.55;

    // Ellipse parameters (stylized Earth; Mars is outer rim)
    const a = 260, b = 230; // Earth semi‑axes (exaggerated)
    const c = Math.sqrt(Math.max(a*a - b*b, 0));
    const sun = { x: cx - c, y: cy };

    // Mars ellipse (outer rim) — scaled outward and slightly more eccentric
    const aM = a * 1.55;                   // semi‑major ~1.55× Earth visual
    const eM = 0.25;                       // stylized eccentricity (real ≈ 0.093)
    const bM = aM * Math.sqrt(1 - eM*eM);  // semi‑minor per stylized e
    const cM = Math.sqrt(Math.max(aM*aM - bM*bM, 0));
    const sunM = sun; // same heliocentric focus

    function getCSS(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim(); }

    // ===== World/year configs =====
    const WORLDS = {
      earth: { name: 'Earth', orbitalDays: 365, recommendedSeasons: 4 },
      mars:  { name: 'Mars',  orbitalDays: 687, recommendedSeasons: 4 },
      coorb: { name: 'Co‑Orbital', orbitalDays: 540, recommendedSeasons: 6 }, // nominal between Earth & Mars
    };

    const BASIS = {
      orbital: (world)=>WORLDS[world].orbitalDays,
      1080: ()=>1080,
      1290: ()=>1080, // treat 12×90 as same span as 1080 for geometry; labels differ
    };

    const MONTHS = {
      1080: { count: 36, daysPer: 30 },
      1290: { count: 12, daysPer: 90 },
      orbital: null // derived from world; not shown as months
    };

    // UI elements
    const worldSel = document.getElementById('world');
    const basisSel = document.getElementById('basis');
    const seasonsSlider = document.getElementById('seasons');
    const lockRecommended = document.getElementById('lockRecommended');
    const daySlider = document.getElementById('day');
    const dayVal = document.getElementById('dayVal');
    const yearLenSpan = document.getElementById('yearLen');
    const showMonths = document.getElementById('showMonths');
    const showBounds = document.getElementById('showBounds');
    const showMars = document.getElementById('showMars');
    const readout = document.getElementById('readout');

    let playing = false;
    let theta = 0; // phase anchor for play loop

    // Geometry helpers
    function ellipsePoint(th){ return { x: cx + a*Math.cos(th),  y: cy + b*Math.sin(th)  }; }
    function ellipsePointMars(th){ return { x: cx + aM*Math.cos(th), y: cy + bM*Math.sin(th) }; }

    function drawGrid(){
      ctx.save(); ctx.lineWidth = 1; ctx.strokeStyle = getCSS('--grid');
      const step = 50;
      for(let x = step/2; x < W; x += step){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
      for(let y = step/2; y < H; y += step){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }
      ctx.restore();
    }
    function drawSun(){
      const r=28; const g = ctx.createRadialGradient(sun.x, sun.y, 2, sun.x, sun.y, 50);
      g.addColorStop(0,'#fff6d1'); g.addColorStop(1,'rgba(255, 200, 60, 0.05)');
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(sun.x, sun.y, 60, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle='#ffd35a'; ctx.beginPath(); ctx.arc(sun.x, sun.y, r, 0, Math.PI*2); ctx.fill();
      ctx.strokeStyle='rgba(255,211,90,0.4)'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(sun.x, sun.y, r+6, 0, Math.PI*2); ctx.stroke();
    }
    function drawOrbitOutline(){
      // Earth
      ctx.save(); ctx.lineWidth=2; ctx.strokeStyle='rgba(200,220,255,0.6)'; ctx.setLineDash([4,4]);
      ctx.beginPath(); for(let t=0;t<=1.0001;t+=0.01){ const th=t*Math.PI*2; const p=ellipsePoint(th); if(t===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y);} ctx.closePath(); ctx.stroke(); ctx.setLineDash([]); ctx.restore();
      // Mars (outer rim)
      if(showMars.checked){
        ctx.save(); ctx.lineWidth=2; ctx.strokeStyle='rgba(255,173,122,0.55)'; ctx.setLineDash([6,4]);
        ctx.beginPath(); for(let t=0;t<=1.0001;t+=0.01){ const th=t*Math.PI*2; const p=ellipsePointMars(th); if(t===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y);} ctx.closePath(); ctx.stroke(); ctx.setLineDash([]); ctx.restore();
      }
    }

    // Render sections for N seasons equally spaced (applied to the active world ring i.e., Earth ring for now)
    function sectionColors(N){
      const base = [getCSS('--spring'), getCSS('--summer'), getCSS('--autumn'), getCSS('--winter'), getCSS('--sec5'), getCSS('--sec6')];
      return Array.from({length:N}, (_,i)=> base[i % base.length]);
    }
    function drawSections(N){
      const colors = sectionColors(N);
      for(let i=0;i<N;i++){
        const start = (i/N)*Math.PI*2, end=((i+1)/N)*Math.PI*2; drawRibbon(start,end,colors[i]);
      }
    }
    function drawRibbon(start,end,color){
      ctx.save(); ctx.strokeStyle = color; ctx.lineWidth = 14; ctx.lineCap='round';
      const steps=140; ctx.beginPath();
      for(let i=0;i<=steps;i++){ const u=i/steps; const th=start + (end-start)*u; const p=ellipsePoint(th); if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y);} ctx.stroke(); ctx.restore();
    }

    function drawMonthTicks(totalDays, basis){
      const meta = MONTHS[basis]; if(!meta || !showMonths.checked) return;
      const { count, daysPer } = meta;
      // Earth month ticks
      ctx.save(); ctx.strokeStyle='rgba(255,255,255,0.18)'; ctx.lineWidth=1; ctx.setLineDash([2,3]);
      for(let m=0;m<count;m++){
        const day = m*daysPer; const th = (day/totalDays)*Math.PI*2; const p=ellipsePoint(th);
        const L=12; const dir = Math.atan2(b*Math.cos(th), -a*Math.sin(th));
        const x1=p.x + Math.cos(dir)*L, y1=p.y + Math.sin(dir)*L; const x2=p.x - Math.cos(dir)*L, y2=p.y - Math.sin(dir)*L;
        ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
      }
      // Mars month ticks (lighter)
      if(showMars.checked){
        for(let m=0;m<count;m++){
          const day = m*daysPer; const th = (day/totalDays)*Math.PI*2; const p=ellipsePointMars(th);
          const L=12; const dir = Math.atan2(bM*Math.cos(th), -aM*Math.sin(th));
          ctx.strokeStyle='rgba(255,173,122,0.25)';
          const x1=p.x + Math.cos(dir)*L, y1=p.y + Math.sin(dir)*L; const x2=p.x - Math.cos(dir)*L, y2=p.y - Math.sin(dir)*L;
          ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
        }
      }
      ctx.setLineDash([]); ctx.restore();
    }

    function drawBoundTick(th,label){
      if(!showBounds.checked) return;
      const p=ellipsePoint(th); ctx.save(); ctx.strokeStyle='rgba(255,255,255,0.6)'; ctx.lineWidth=1.5; const L=18; const dir=Math.atan2(b*Math.cos(th), -a*Math.sin(th));
      const x1=p.x + Math.cos(dir)*L, y1=p.y + Math.sin(dir)*L; const x2=p.x - Math.cos(dir)*L, y2=p.y - Math.sin(dir)*L;
      ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke(); ctx.fillStyle='rgba(230,238,252,0.9)'; ctx.font='12px system-ui, Segoe UI, Arial'; ctx.textAlign='center';
      ctx.fillText(label, x1 + Math.cos(dir)*18, y1 + Math.sin(dir)*18); ctx.restore();
    }

    function drawEarth(theta){
      const p=ellipsePoint(theta);
      // trail
      ctx.save(); ctx.strokeStyle='rgba(160,200,255,0.25)'; ctx.lineWidth=2; ctx.beginPath();
      for(let i=0;i<=64;i++){ const u=i/64; const th=theta - u*0.25; const q=ellipsePoint(th); if(i===0) ctx.moveTo(q.x,q.y); else ctx.lineTo(q.x,q.y);} ctx.stroke(); ctx.restore();
      // planet
      const g=ctx.createRadialGradient(p.x-4,p.y-4,1,p.x,p.y,9); g.addColorStop(0,'#bfe6ff'); g.addColorStop(1,'#2b72ff'); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,7,0,Math.PI*2); ctx.fill();
      // line to Sun
      ctx.save(); ctx.strokeStyle='rgba(255,255,255,0.18)'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(sun.x,sun.y); ctx.lineTo(p.x,p.y); ctx.stroke(); ctx.restore();
    }

    function drawMars(theta){
      if(!showMars.checked) return;
      const p=ellipsePointMars(theta);
      // trail
      ctx.save(); ctx.strokeStyle='rgba(255,173,122,0.22)'; ctx.lineWidth=2; ctx.beginPath();
      for(let i=0;i<=64;i++){ const u=i/64; const th=theta - u*0.25; const q=ellipsePointMars(th); if(i===0) ctx.moveTo(q.x,q.y); else ctx.lineTo(q.x,q.y);} ctx.stroke(); ctx.restore();
      // planet (warm orange)
      const g=ctx.createRadialGradient(p.x-4,p.y-4,1,p.x,p.y,9); g.addColorStop(0,'#ffd7c0'); g.addColorStop(1,'#ff782a'); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,6.5,0,Math.PI*2); ctx.fill();
      // line to Sun
      ctx.save(); ctx.strokeStyle='rgba(255,173,122,0.25)'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(sunM.x,sunM.y); ctx.lineTo(p.x,p.y); ctx.stroke(); ctx.restore();
    }

    function currentYearLength(){
      const w = worldSel.value; const b = basisSel.value; return BASIS[b](w);
    }

    function updateRanges(){
      const Y = currentYearLength();
      daySlider.max = Y; yearLenSpan.textContent = Y; if(parseInt(daySlider.value,10) > Y){ daySlider.value = 0; }
    }

    function recommendedSeasonsFor(world){ return WORLDS[world].recommendedSeasons; }

    function updateSeasonLock(){
      if(lockRecommended.checked){
        const rec = recommendedSeasonsFor(worldSel.value);
        seasonsSlider.value = rec; seasonsSlider.disabled = true;
      } else { seasonsSlider.disabled = false; }
    }

    function dayToTheta(day){ const Y=currentYearLength(); return (day / Y) * Math.PI*2; }
    function thetaToDay(th){ const Y=currentYearLength(); return ((th%(Math.PI*2)+Math.PI*2)%(Math.PI*2))/(Math.PI*2) * Y; }

    const EQS = ['Vernal Eq.','June Sol.','Autumn Eq.','Dec. Sol.'];

    function render(){
      ctx.clearRect(0,0,W,H); drawGrid();
      const N = parseInt(seasonsSlider.value,10);
      drawSections(N); drawOrbitOutline(); drawSun();
      for(let i=0;i<4;i++){ drawBoundTick(i*Math.PI/2, EQS[i]); }
      drawMonthTicks(currentYearLength(), basisSel.value);
      // Compute both Earth & Mars angles from current day slider under selected basis
      const dayNow = parseInt(daySlider.value,10);
      const thetaE = dayToTheta(dayNow);
      const marsYear = BASIS[basisSel.value]('mars');
      const thetaM = (dayNow % marsYear) / marsYear * Math.PI*2; // wraps if Earth basis shorter
      drawEarth(thetaE); drawMars(thetaM);
      const doyE = Math.round(thetaToDay(thetaE));
      const doyM = Math.round(((thetaM%(Math.PI*2)+Math.PI*2)%(Math.PI*2))/(Math.PI*2)*marsYear);
      dayVal.textContent = doyE;
      readout.textContent = `${WORLDS[worldSel.value].name} · ${basisSel.options[basisSel.selectedIndex].text} · Seasons: ${N} · Earth θ=${(thetaE%(Math.PI*2)).toFixed(2)} · Mars θ=${(thetaM%(Math.PI*2)).toFixed(2)} · DayE ${doyE}/${currentYearLength()} · DayM ${doyM}/${marsYear}`;
    }

    function tick(){ if(playing){ theta += 0.0045; const newDay = Math.round(thetaToDay(theta)); daySlider.value = newDay; render(); requestAnimationFrame(tick);} }

    // ===== Events =====
    worldSel.addEventListener('change', ()=>{ updateRanges(); updateSeasonLock(); render(); });
    basisSel.addEventListener('change', ()=>{ updateRanges(); render(); });
    seasonsSlider.addEventListener('input', ()=> render());
    lockRecommended.addEventListener('change', ()=>{ updateSeasonLock(); render(); });
    daySlider.addEventListener('input', ()=>{ theta = dayToTheta(parseInt(daySlider.value,10)); render(); });
    document.getElementById('play').addEventListener('click', ()=>{ if(!playing){ playing=true; requestAnimationFrame(tick);} });
    document.getElementById('pause').addEventListener('click', ()=> playing=false);
    document.getElementById('reset').addEventListener('click', ()=>{ playing=false; daySlider.value=0; theta=0; render(); });
    showMonths.addEventListener('change', render);
    showBounds.addEventListener('change', render);
    showMars.addEventListener('change', render);

    // init
    updateRanges(); updateSeasonLock(); render();
  </script>
</body>
</html>
